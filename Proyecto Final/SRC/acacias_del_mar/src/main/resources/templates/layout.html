<!DOCTYPE html>
<!-- 1. Definimos el fragmento 'layout' que envolverá todo -->
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="layout(title, content)">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- 2. El título de la página se reemplaza dinámicamente -->
        <title th:replace="${title}">Título por Defecto</title>

        <!-- 3. Links a CSS (Bulma y Font Awesome) -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

        <!-- Estilo simple para que el layout ocupe toda la altura -->
        <style>
            .main-content {
                min-height: calc(100vh - 52px - 148px); /* Alto total - navbar - footer */
            }
        </style>
    </head>

    <body>

        <!-- Cabecera (Navbar de Bulma) -->
        <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <a class="navbar-item" th:href="@{/home}">
                    <i class="fas fa-water fa-2x mr-2"></i>
                    <span class="is-size-4">Acacias del Mar</span>
                </a>
            </div>
            <div class="navbar-menu">
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="buttons">
                            <!-- Formulario de Logout (oculto en un botón) -->
                            <form th:action="@{/logout}" method="post" id="logoutForm">
                                <button class_   ="button is-light" type="submit">
                                    <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                                    <span>Cerrar Sesión</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contenido Principal (Layout de 2 Columnas) -->
        <div class="columns main-content m-0">

            <!-- Columna 1: Menú Lateral (Sidebar) -->
            <div class="column is-one-fifth has-background-light p-4">
                <aside class="menu">
                    <p class="menu-label">
                        General
                    </p>
                    <ul class="menu-list">
                        <!-- Usamos la variable 'currentPage' que pasamos desde el controlador -->
                        <li><a th:href="@{/home}" th:classappend="${currentPage == '/home' ? 'is-active' : ''}"><span class="icon"><i class="fas fa-home"></i></span> Inicio</a></li>
                    </ul>

                    <!-- ==================================
                         SECCIÓN SÓLO PARA ADMINISTRADORES
                    =================================== -->
                    <div sec:authorize="hasRole('ADMINISTRADOR')">
                        <p class="menu-label">
                            Administración
                        </p>
                        <ul class="menu-list">
                            <li>
                                <a th:href="@{/admin/socios}" th:classappend="${currentPage == '/admin/socios' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-users"></i></span> Socios
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/empleados}" th:classappend="${currentPage == '/admin/empleados' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-user-shield"></i></span> Empleados
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/zonas}" th:classappend="${currentPage == '/admin/zonas' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-map-marked-alt"></i></span> Zonas
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/garages}" th:classappend="${currentPage == '/admin/garages' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-warehouse"></i></span> Garages
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/vehiculos}" th:classappend="${currentPage == '/admin/vehiculos' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-caravan"></i></span> Vehículos
                                </a>
                            </li>
                        </ul>
                        <p class="menu-label">
                            Asignaciones
                        </p>
                        <ul class="menu-list">
                            <li>
                                <a th:href="@{/admin/asignaciones}" th:classappend="${currentPage == '/admin/asignaciones' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-calendar-check"></i></span> Asignaciones V-G
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/asignaciones-ez}" th:classappend="${currentPage == '/admin/asignaciones-ez' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-user-tag"></i></span> Asignaciones E-Z
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/admin/compras}" th:classappend="${currentPage == '/admin/compras' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-file-invoice-dollar"></i></span> Compras
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- ==================================
                         SECCIÓN SÓLO PARA EMPLEADOS
                    =================================== -->
                    <div sec:authorize="hasRole('EMPLEADO')">
                        <p class="menu-label">
                            Portal Empleado
                        </p>
                        <ul class="menu-list">
                            <li>
                                <a th:href="@{/empleado/dashboard}" th:classappend="${currentPage == '/empleado/dashboard' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-clipboard-list"></i></span> Ver Asignaciones
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- ==================================
                         SECCIÓN SÓLO PARA SOCIOS
                    =================================== -->
                    <div sec:authorize="hasRole('SOCIO')">
                        <p class="menu-label">
                            Portal Socio
                        </p>
                        <ul class="menu-list">
                            <li>
                                <a th:href="@{/socio/dashboard}" th:classappend="${currentPage == '/socio/dashboard' ? 'is-active' : ''}">
                                    <span class="icon"><i class="fas fa-search"></i></span> Consultas
                                </a>
                            </li>
                        </ul>
                    </div>

                </aside>
            </div>

            <!-- Columna 2: Contenido Dinámico de la Página -->
            <div class="column is-four-fifths p-5">
                <main>
                    <!-- 4. El contenido de la página (ej. admin/socios.html) se inserta aquí -->
                    <div th:replace="${content}">
                        <!-- Este es el contenido por defecto si una página no define un 'content' -->
                        <h1 class="title">Error de Plantilla</h1>
                        <p>El contenido de la página no pudo ser cargado.</p>
                    </div>
                </main>
            </div>

        </div> <!-- fin .columns -->

        <!-- Pie de Página -->
        <footer class="footer mt-auto p-4 has-background-dark has-text-light">
            <div class="content has-text-centered">
                <p>
                    <strong>Proyecto Acacias del Mar</strong> - <span>Proyecto final de Programación II.</span>
                </p>
            </div>
        </footer>

    </body>
</html>